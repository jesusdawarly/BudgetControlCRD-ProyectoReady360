<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sistema de Control Presupuestario - Cruz Roja Dominicana</title>
  <style>
    /* RESET BÁSICO */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #fefefe;
      color: #222;
      padding: 20px;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: flex-start;
    }

    .container {
      width: 100%;
      max-width: 1200px;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 10px 30px rgb(220 38 38 / 0.15);
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    /* HEADER */
    .header {
      background: linear-gradient(135deg, #dc2626, #991b1b);
      color: white;
      padding: 24px 32px;
      text-align: center;
    }

    .header h1 {
      font-weight: 700;
      font-size: 2.25rem;
      margin-bottom: 6px;
      letter-spacing: 0.05em;
    }

    .header p {
      font-weight: 500;
      font-size: 1rem;
      opacity: 0.85;
      line-height: 1.3;
    }

    /* CONTROLES */
    .controls {
      padding: 24px 32px;
      border-bottom: 1px solid #eee;
      background: #fafafa;
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      align-items: flex-end;
      justify-content: space-between;
    }

    .switches {
      display: flex;
      gap: 20px;
      align-items: flex-end;
    }

    .add-expense {
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
      flex-grow: 1;
      min-width: 320px;
      align-items: flex-end;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 6px;
      min-width: 140px;
      flex: 1 1 auto;
    }

    label {
      font-weight: 600;
      font-size: 0.9rem;
      color: #444;
    }

    select,
    input[type='number'],
    input[type='text'] {
      padding: 10px 14px;
      border: 1.5px solid #ccc;
      border-radius: 8px;
      font-size: 1rem;
      transition: border-color 0.25s ease;
      background: white;
      color: #222;
    }

    select:focus,
    input[type='number']:focus,
    input[type='text']:focus {
      outline: none;
      border-color: #dc2626;
      box-shadow: 0 0 6px rgb(220 38 38 / 0.3);
    }

    button.btn {
      background: #dc2626;
      color: white;
      font-weight: 700;
      border: none;
      border-radius: 8px;
      padding: 12px 28px;
      cursor: pointer;
      transition: background 0.3s ease;
      flex-shrink: 0;
      font-size: 1rem;
      box-shadow: 0 4px 12px rgb(220 38 38 / 0.3);
    }

    button.btn:hover {
      background: #a02121;
      box-shadow: 0 6px 20px rgb(160 33 33 / 0.5);
    }

    /* RESUMEN */
    .summary {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(230px, 1fr));
      gap: 16px;
      padding: 24px 32px;
      background: #f9f9f9;
      border-bottom: 1px solid #eee;
    }

    .summary-card {
      background: white;
      padding: 20px 24px;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgb(0 0 0 / 0.05);
      border-left: 5px solid transparent;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }

    .summary-card.total {
      border-left-color: #2563eb;
    }

    .summary-card.used {
      border-left-color: #dc2626;
    }

    .summary-card.remaining {
      border-left-color: #059669;
    }

    .summary-card h3 {
      font-weight: 600;
      font-size: 0.85rem;
      text-transform: uppercase;
      color: #555;
      margin-bottom: 8px;
      letter-spacing: 0.05em;
    }

    .summary-card .amount {
      font-weight: 700;
      font-size: 1.75rem;
      color: #111;
      white-space: nowrap;
    }

    /* TABLA */
    .table-container {
      overflow-x: auto;
      padding: 24px 32px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.9rem;
      color: #333;
      min-width: 900px;
    }

    th {
      background: #991b1b;
      color: white;
      font-weight: 600;
      text-align: left;
      padding: 14px 12px;
      position: sticky;
      top: 0;
      z-index: 5;
      letter-spacing: 0.04em;
    }

    td {
      padding: 12px 12px;
      border-bottom: 1px solid #eee;
      vertical-align: top;
    }

    tr:hover {
      background: #f4f4f4;
    }

    .code {
      font-family: 'Courier New', monospace;
      background: #f9f9f9;
      padding: 3px 6px;
      border-radius: 4px;
      font-weight: 600;
      font-size: 0.85rem;
      color: #991b1b;
      user-select: all;
    }

    .amount {
      text-align: right;
      font-weight: 600;
      white-space: nowrap;
    }

    .amount.positive {
      color: #059669;
    }

    .amount.negative {
      color: #dc2626;
    }

    .category {
      font-weight: 600;
      color: #991b1b;
      font-size: 0.9rem;
    }

    .progress-bar {
      height: 8px;
      background: #eee;
      border-radius: 4px;
      overflow: hidden;
      margin-top: 6px;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #059669 0%, #10b981 100%);
      transition: width 0.3s ease;
    }

    .progress-fill.over {
      background: linear-gradient(90deg, #dc2626 0%, #ef4444 100%);
    }

    .expense-log {
      max-height: 180px;
      overflow-y: auto;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 8px 12px;
      background: #fafafa;
      font-size: 0.85rem;
      color: #555;
    }

    .expense-item {
      display: flex;
      justify-content: space-between;
      padding: 6px 0;
      border-bottom: 1px solid #eee;
    }

    .expense-item:last-child {
      border-bottom: none;
    }

    .expense-date {
      font-size: 0.75rem;
      color: #999;
    }

    .expense-amount {
      font-weight: 700;
      color: #dc2626;
      white-space: nowrap;
      margin-left: 12px;
    }

    /* RESPONSIVE */
    @media (max-width: 768px) {
      .controls {
        flex-direction: column;
        align-items: stretch;
      }

      .add-expense {
        flex-direction: column;
        min-width: auto;
      }

      .form-group {
        min-width: 100%;
      }

      table {
        font-size: 0.85rem;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1 data-i18n="title">Sistema de Control Presupuestario</h1>
      <p data-i18n="subtitle">Cruz Roja Dominicana - Proyecto Ready 360</p>
      <p style="font-size: 0.85rem; margin-top: 4px;" data-i18n="footer">Software presupuestario hecho por Jesus Dawarly Ramirez (Administrador)</p>
    </div>

    <div class="controls">
      <div class="switches">
        <div class="currency-switch form-group">
          <label for="currencySwitch" data-i18n="currencyLabel">Moneda</label>
          <select id="currencySwitch" onchange="toggleCurrency()">
            <option value="EUR" selected data-i18n="currencyEuro">Euros (€)</option>
            <option value="DOP" data-i18n="currencyDOP">Pesos Dominicanos (RD$)</option>
          </select>
        </div>
        <div class="language-switch form-group">
          <label for="languageSwitch" data-i18n="languageLabel">Idioma</label>
          <select id="languageSwitch" onchange="toggleLanguage()">
            <option value="es" selected>Español</option>
            <option value="fr">Français</option>
          </select>
        </div>
      </div>

      <div class="add-expense">
        <div class="form-group">
          <label for="expenseCategory" data-i18n="selectCategoryLabel">Partida Presupuestaria</label>
          <select id="expenseCategory"></select>
        </div>
        <div class="form-group">
          <label for="expenseAmount" id="expenseAmountLabel" data-i18n="amountLabel">Monto (€)</label>
          <input type="number" id="expenseAmount" placeholder="0.00" step="0.01" min="0" />
        </div>
        <div class="form-group">
          <label for="expenseDescription" data-i18n="descriptionLabel">Descripción del Gasto</label>
          <input type="text" id="expenseDescription" placeholder="" />
        </div>
        <button class="btn" id="addExpenseBtn" onclick="addExpense()" data-i18n="btnAddExpense">Registrar Gasto</button>
      </div>
    </div>

    <div class="summary">
      <div class="summary-card total">
        <h3 data-i18n="totalBudgetTitle">Presupuesto Total</h3>
        <div class="amount" id="totalBudget">€217,831</div>
      </div>
      <div class="summary-card used">
        <h3 data-i18n="totalUsedTitle">Total Ejecutado</h3>
        <div class="amount" id="totalUsed">€0</div>
      </div>
      <div class="summary-card remaining">
        <h3 data-i18n="totalRemainingTitle">Saldo Disponible</h3>
        <div class="amount" id="totalRemaining">€217,831</div>
      </div>
    </div>

    <div class="table-container">
      <table id="budgetTable">
        <thead>
          <tr>
            <th data-i18n="tableCode">Código</th>
            <th data-i18n="tableDescription">Partida / Descripción</th>
            <th data-i18n="tableCategory">Categoría</th>
            <th data-i18n="tableOriginalBudget">Presupuesto Original (€)</th>
            <th data-i18n="tableUsed">Gastado (€)</th>
            <th data-i18n="tableBalance">Saldo (€)</th>
            <th data-i18n="tablePercent">%</th>
            <th data-i18n="tableExpenses">Historial de Gastos</th>
          </tr>
        </thead>
        <tbody id="budgetTableBody"></tbody>
      </table>
    </div>
  </div>

  <script>
    const budgetData = [
      // Aquí debes colocar tu arreglo completo original sin cambios
      {
        code: "HR.SUP",
        description: { es: "Supervisor Logístico/Administrativo", fr: "Superviseur Logistique/Administratif" },
        category: { es: "Recursos Humanos", fr: "Ressources Humaines" },
        originalBudget: 20000,
        used: 0,
        expenses: []
      },
      {
        code: "HR.PM",
        description: { es: "Coordinador del Proyecto (24 meses)", fr: "Coordinateur de Projet (24 mois)" },
        category: { es: "Recursos Humanos", fr: "Ressources Humaines" },
        originalBudget: 24000,
        used: 0,
        expenses: []
      },
      // ... Resto igual, ejemplo parcial
      {
        code: "IND",
        description: { es: "Costos Indirectos (3%)", fr: "Coûts Indirects (3%)" },
        category: { es: "Costos Indirectos", fr: "Coûts Indirects" },
        originalBudget: 6345,
        used: 0,
        expenses: []
      }
    ];

    const exchangeRate = 60; // 1 EUR = 60 DOP (tasa fija)
    let currentCurrency = 'EUR';
    let currentLanguage = 'es';

    // Textos traducibles estáticos
    const translations = {
      es: {
        title: "Sistema de Control Presupuestario",
        subtitle: "Cruz Roja Dominicana - Proyecto Ready 360",
        footer: "Software presupuestario hecho por Jesus Dawarly Ramirez (Administrador)",
        currencyLabel: "Moneda",
        currencyEuro: "Euros (€)",
        currencyDOP: "Pesos Dominicanos (RD$)",
        languageLabel: "Idioma",
        selectCategoryLabel: "Partida Presupuestaria",
        amountLabel: "Monto (€)",
        descriptionLabel: "Descripción del Gasto",
        btnAddExpense: "Registrar Gasto",
        totalBudgetTitle: "Presupuesto Total",
        totalUsedTitle: "Total Ejecutado",
        totalRemainingTitle: "Saldo Disponible",
        tableCode: "Código",
        tableDescription: "Partida / Descripción",
        tableCategory: "Categoría",
        tableOriginalBudget: "Presupuesto Original (€)",
        tableUsed: "Gastado (€)",
        tableBalance: "Saldo (€)",
        tablePercent: "%",
        tableExpenses: "Historial de Gastos",
        selectCategoryPlaceholder: "Seleccione una partida...",
        expenseDescriptionPlaceholder: "Detalle del gasto",
        alertFillFields: "Por favor complete todos los campos correctamente.",
        alertCategoryNotFound: "Partida no encontrada."
      },
      fr: {
        title: "Système de Contrôle Budgétaire",
        subtitle: "Croix-Rouge Dominicaine - Projet Ready 360",
        footer: "Logiciel budgétaire créé par Jesus Dawarly Ramirez (Administrateur)",
        currencyLabel: "Devise",
        currencyEuro: "Euros (€)",
        currencyDOP: "Pesos Dominicains (RD$)",
        languageLabel: "Langue",
        selectCategoryLabel: "Poste Budgétaire",
        amountLabel: "Montant (€)",
        descriptionLabel: "Description de la Dépense",
        btnAddExpense: "Enregistrer la Dépense",
        totalBudgetTitle: "Budget Total",
        totalUsedTitle: "Total Dépensé",
        totalRemainingTitle: "Solde Disponible",
        tableCode: "Code",
        tableDescription: "Poste / Description",
        tableCategory: "Catégorie",
        tableOriginalBudget: "Budget Initial (€)",
        tableUsed: "Dépensé (€)",
        tableBalance: "Solde (€)",
        tablePercent: "%",
        tableExpenses: "Historique des Dépenses",
        selectCategoryPlaceholder: "Sélectionnez un poste...",
        expenseDescriptionPlaceholder: "Détail de la dépense",
        alertFillFields: "Veuillez remplir correctement tous les champs.",
        alertCategoryNotFound: "Poste non trouvé."
      }
    };

    function translatePage() {
      document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.getAttribute('data-i18n');
        if (translations[currentLanguage] && translations[currentLanguage][key]) {
          el.textContent = translations[currentLanguage][key];
        }
      });

      // Cambiar placeholders
      document.getElementById('expenseCategory').options[0].textContent = translations[currentLanguage].selectCategoryPlaceholder;
      document.getElementById('expenseDescription').placeholder = translations[currentLanguage].expenseDescriptionPlaceholder;

      // Actualizar label monto según moneda e idioma
      updateAmountLabel();

      // Actualizar opciones de moneda (por si cambian el idioma)
      const currencySelect = document.getElementById('currencySwitch');
      currencySelect.options[0].textContent = translations[currentLanguage].currencyEuro;
      currencySelect.options[1].textContent = translations[currentLanguage].currencyDOP;

      // Actualizar select partidas con traducción actualizada
      populateSelect();
      renderTable();
      updateSummary();
    }

    function updateAmountLabel() {
      const label = document.getElementById('expenseAmountLabel');
      const symbol = currentCurrency === 'EUR' ? (currentLanguage === 'fr' ? '€' : '€') : (currentLanguage === 'fr' ? 'RD$' : 'RD$');
      const amountText = currentLanguage === 'fr'
        ? `Montant (${symbol})`
        : `Monto (${symbol})`;
      label.textContent = amountText;
    }

    function toggleCurrency() {
      const select = document.getElementById('currencySwitch');
      currentCurrency = select.value;

      // Ajustar placeholder y etiqueta monto
      updateAmountLabel();

      renderTable();
      updateSummary();
    }

    function toggleLanguage() {
      const select = document.getElementById('languageSwitch');
      currentLanguage = select.value;

      translatePage();
    }

    function populateSelect() {
      const select = document.getElementById('expenseCategory');
      select.innerHTML = '';
      const placeholderOption = document.createElement('option');
      placeholderOption.value = "";
      placeholderOption.disabled = true;
      placeholderOption.selected = true;
      placeholderOption.textContent = translations[currentLanguage].selectCategoryPlaceholder;
      select.appendChild(placeholderOption);

      budgetData.forEach(item => {
        const option = document.createElement('option');
        option.value = item.code;
        option.textContent = item.description[currentLanguage];
        select.appendChild(option);
      });
    }

    function formatCurrency(value) {
      if (currentCurrency === 'EUR') {
        return new Intl.NumberFormat(currentLanguage === 'fr' ? 'fr-FR' : 'es-ES', { style: 'currency', currency: 'EUR' }).format(value);
      } else {
        return new Intl.NumberFormat(currentLanguage === 'fr' ? 'fr-HT' : 'es-DO', { style: 'currency', currency: 'DOP' }).format(value);
      }
    }

    function addExpense() {
      const categorySelect = document.getElementById('expenseCategory');
      const amountInput = document.getElementById('expenseAmount');
      const descriptionInput = document.getElementById('expenseDescription');

      const code = categorySelect.value;
      const amountRaw = parseFloat(amountInput.value);
      const description = descriptionInput.value.trim();

      if (!code || isNaN(amountRaw) || amountRaw <= 0 || !description) {
        alert(translations[currentLanguage].alertFillFields);
        return;
      }

      const categoryObj = budgetData.find(item => item.code === code);
      if (!categoryObj) {
        alert(translations[currentLanguage].alertCategoryNotFound);
        return;
      }

      // Convierte monto a euros si está en pesos
      let amount = amountRaw;
      if (currentCurrency === 'DOP') {
        amount = amountRaw / exchangeRate;
      }

      categoryObj.used += amount;
      categoryObj.expenses.push({
        amount,
        description,
        date: new Date()
      });

      // Limpieza y reset inputs
      amountInput.value = '';
      descriptionInput.value = '';
      categorySelect.selectedIndex = 0;

      renderTable();
      updateSummary();
    }

    function renderTable() {
      const tbody = document.getElementById('budgetTableBody');
      tbody.innerHTML = '';

      budgetData.forEach(item => {
        const balance = item.originalBudget - item.used;
        const percentUsed = (item.used / item.originalBudget) * 100;

        // Ajustar valores por moneda
        let original = item.originalBudget;
        let used = item.used;
        let bal = balance;
        if (currentCurrency === 'DOP') {
          original = original * exchangeRate;
          used = used * exchangeRate;
          bal = bal * exchangeRate;
        }

        const tr = document.createElement('tr');

        // Código
        const tdCode = document.createElement('td');
        tdCode.textContent = item.code;
        tdCode.className = 'code';
        tr.appendChild(tdCode);

        // Descripción
        const tdDesc = document.createElement('td');
        tdDesc.textContent = item.description[currentLanguage];
        tr.appendChild(tdDesc);

        // Categoría
        const tdCat = document.createElement('td');
        tdCat.textContent = item.category[currentLanguage];
        tdCat.className = 'category';
        tr.appendChild(tdCat);

        // Presupuesto Original
        const tdOriginal = document.createElement('td');
        tdOriginal.className = 'amount';
        tdOriginal.textContent = formatCurrency(original);
        tr.appendChild(tdOriginal);

        // Gastado
        const tdUsed = document.createElement('td');
        tdUsed.className = 'amount positive';
        tdUsed.textContent = formatCurrency(used);
        tr.appendChild(tdUsed);

        // Saldo
        const tdBalance = document.createElement('td');
        tdBalance.className = 'amount';
        tdBalance.textContent = formatCurrency(bal);
        tdBalance.classList.add(bal >= 0 ? 'positive' : 'negative');
        tr.appendChild(tdBalance);

        // %
        const tdPercent = document.createElement('td');
        tdPercent.style.minWidth = "110px";
        const progress = document.createElement('div');
        progress.className = 'progress-bar';
        const progressFill = document.createElement('div');
        progressFill.className = 'progress-fill';
        progressFill.style.width = Math.min(percentUsed, 100) + '%';
        if (percentUsed > 100) {
          progressFill.classList.add('over');
        }
        progress.appendChild(progressFill);
        tdPercent.appendChild(progress);
        tr.appendChild(tdPercent);

        // Historial Gastos
        const tdExpenses = document.createElement('td');
        tdExpenses.style.minWidth = '200px';
        if (item.expenses.length === 0) {
          tdExpenses.textContent = '-';
        } else {
          const logDiv = document.createElement('div');
          logDiv.className = 'expense-log';
          item.expenses.forEach(e => {
            const expDiv = document.createElement('div');
            expDiv.className = 'expense-item';

            const descSpan = document.createElement('span');
            descSpan.textContent = e.description;

            const dateSpan = document.createElement('span');
            dateSpan.className = 'expense-date';
            dateSpan.textContent = e.date.toLocaleDateString(currentLanguage);

            const amountSpan = document.createElement('span');
            amountSpan.className = 'expense-amount';
            amountSpan.textContent = formatCurrency(currentCurrency === 'EUR' ? e.amount : e.amount * exchangeRate);

            expDiv.appendChild(descSpan);
            expDiv.appendChild(dateSpan);
            expDiv.appendChild(amountSpan);

            logDiv.appendChild(expDiv);
          });
          tdExpenses.appendChild(logDiv);
        }
        tr.appendChild(tdExpenses);

        tbody.appendChild(tr);
      });
    }

    function updateSummary() {
      const totalOriginal = budgetData.reduce((acc, cur) => acc + cur.originalBudget, 0);
      const totalUsed = budgetData.reduce((acc, cur) => acc + cur.used, 0);
      const totalRemaining = totalOriginal - totalUsed;

      let totalOrigDisplay = totalOriginal;
      let totalUsedDisplay = totalUsed;
      let totalRemainingDisplay = totalRemaining;

      if (currentCurrency === 'DOP') {
        totalOrigDisplay *= exchangeRate;
        totalUsedDisplay *= exchangeRate;
        totalRemainingDisplay *= exchangeRate;
      }

      document.getElementById('totalBudget').textContent = formatCurrency(totalOrigDisplay);
      document.getElementById('totalUsed').textContent = formatCurrency(totalUsedDisplay);
      document.getElementById('totalRemaining').textContent = formatCurrency(totalRemainingDisplay);
    }

    // Inicializar página
    window.onload = () => {
      populateSelect();
      translatePage();
      renderTable();
      updateSummary();
    };
  </script>
</body>
</html>
