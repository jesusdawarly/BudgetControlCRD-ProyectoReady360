<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Control Presupuestario - Cruz Roja Dominicana</title>
  <style>
    /* RESET BÁSICO */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #fefefe;
      color: #222;
      padding: 20px;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: flex-start;
    }

    .container {
      width: 100%;
      max-width: 1200px;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 10px 30px rgb(220 38 38 / 0.15);
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    /* HEADER */
    .header {
      background: linear-gradient(135deg, #dc2626, #991b1b);
      color: white;
      padding: 24px 32px;
      text-align: center;
    }

    .header h1 {
      font-weight: 700;
      font-size: 2.25rem;
      margin-bottom: 6px;
      letter-spacing: 0.05em;
    }

    .header p {
      font-weight: 500;
      font-size: 1rem;
      opacity: 0.85;
      line-height: 1.3;
    }

    /* CONTROLES */
    .controls {
      padding: 24px 32px;
      border-bottom: 1px solid #eee;
      background: #fafafa;
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      align-items: flex-end;
      justify-content: space-between;
    }

    .add-expense {
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
      flex-grow: 1;
      min-width: 320px;
      align-items: flex-end;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 6px;
      min-width: 140px;
      flex: 1 1 auto;
    }

    label {
      font-weight: 600;
      font-size: 0.9rem;
      color: #444;
    }

    select,
    input[type='number'],
    input[type='text'] {
      padding: 10px 14px;
      border: 1.5px solid #ccc;
      border-radius: 8px;
      font-size: 1rem;
      transition: border-color 0.25s ease;
      background: white;
      color: #222;
    }

    select:focus,
    input[type='number']:focus,
    input[type='text']:focus {
      outline: none;
      border-color: #dc2626;
      box-shadow: 0 0 6px rgb(220 38 38 / 0.3);
    }

    button.btn {
      background: #dc2626;
      color: white;
      font-weight: 700;
      border: none;
      border-radius: 8px;
      padding: 12px 28px;
      cursor: pointer;
      transition: background 0.3s ease;
      flex-shrink: 0;
      font-size: 1rem;
      box-shadow: 0 4px 12px rgb(220 38 38 / 0.3);
    }

    button.btn:hover {
      background: #a02121;
      box-shadow: 0 6px 20px rgb(160 33 33 / 0.5);
    }

    /* SELECTOR DE MONEDA */
    .currency-switch {
      min-width: 170px;
    }

    /* RESUMEN */
    .summary {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(230px, 1fr));
      gap: 16px;
      padding: 24px 32px;
      background: #f9f9f9;
      border-bottom: 1px solid #eee;
    }

    .summary-card {
      background: white;
      padding: 20px 24px;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgb(0 0 0 / 0.05);
      border-left: 5px solid transparent;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }

    .summary-card.total {
      border-left-color: #2563eb;
    }

    .summary-card.used {
      border-left-color: #dc2626;
    }

    .summary-card.remaining {
      border-left-color: #059669;
    }

    .summary-card h3 {
      font-weight: 600;
      font-size: 0.85rem;
      text-transform: uppercase;
      color: #555;
      margin-bottom: 8px;
      letter-spacing: 0.05em;
    }

    .summary-card .amount {
      font-weight: 700;
      font-size: 1.75rem;
      color: #111;
      white-space: nowrap;
    }

    /* TABLA */
    .table-container {
      overflow-x: auto;
      padding: 24px 32px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.9rem;
      color: #333;
      min-width: 900px;
    }

    th {
      background: #991b1b;
      color: white;
      font-weight: 600;
      text-align: left;
      padding: 14px 12px;
      position: sticky;
      top: 0;
      z-index: 5;
      letter-spacing: 0.04em;
    }

    td {
      padding: 12px 12px;
      border-bottom: 1px solid #eee;
      vertical-align: top;
    }

    tr:hover {
      background: #f4f4f4;
    }

    .code {
      font-family: 'Courier New', monospace;
      background: #f9f9f9;
      padding: 3px 6px;
      border-radius: 4px;
      font-weight: 600;
      font-size: 0.85rem;
      color: #991b1b;
      user-select: all;
    }

    .amount {
      text-align: right;
      font-weight: 600;
      white-space: nowrap;
    }

    .amount.positive {
      color: #059669;
    }

    .amount.negative {
      color: #dc2626;
    }

    .category {
      font-weight: 600;
      color: #991b1b;
      font-size: 0.9rem;
    }

    .progress-bar {
      height: 8px;
      background: #eee;
      border-radius: 4px;
      overflow: hidden;
      margin-top: 6px;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #059669 0%, #10b981 100%);
      transition: width 0.3s ease;
    }

    .progress-fill.over {
      background: linear-gradient(90deg, #dc2626 0%, #ef4444 100%);
    }

    .expense-log {
      max-height: 180px;
      overflow-y: auto;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 8px 12px;
      background: #fafafa;
      font-size: 0.85rem;
      color: #555;
    }

    .expense-item {
      display: flex;
      justify-content: space-between;
      padding: 6px 0;
      border-bottom: 1px solid #eee;
    }

    .expense-item:last-child {
      border-bottom: none;
    }

    .expense-date {
      font-size: 0.75rem;
      color: #999;
    }

    .expense-amount {
      font-weight: 700;
      color: #dc2626;
      white-space: nowrap;
      margin-left: 12px;
    }

    /* RESPONSIVE */
    @media (max-width: 768px) {
      .controls {
        flex-direction: column;
        align-items: stretch;
      }

      .add-expense {
        flex-direction: column;
        min-width: auto;
      }

      .form-group {
        min-width: 100%;
      }

      table {
        font-size: 0.85rem;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>Sistema de Control Presupuestario</h1>
      <p>Cruz Roja Dominicana - Proyecto Ready 360</p>
      <p>Software presupuestario hecho por Jesus Dawarly Ramirez (Administrador)</p>
    </div>

    <div class="controls">
      <div class="currency-switch form-group">
        <label for="currencySwitch">Moneda</label>
        <select id="currencySwitch" onchange="toggleCurrency()">
          <option value="EUR" selected>Euros (€)</option>
          <option value="DOP">Pesos Dominicanos (RD$)</option>
        </select>
      </div>

      <div class="add-expense">
        <div class="form-group">
          <label for="expenseCategory">Partida Presupuestaria</label>
          <select id="expenseCategory"></select>
        </div>
        <div class="form-group">
          <label for="expenseAmount">Monto (€)</label>
          <input type="number" id="expenseAmount" placeholder="0.00" step="0.01" min="0" />
        </div>
        <div class="form-group">
          <label for="expenseDescription">Descripción del Gasto</label>
          <input type="text" id="expenseDescription" placeholder="Detalle del gasto" />
        </div>
        <button class="btn" onclick="addExpense()">Registrar Gasto</button>
      </div>
    </div>

    <div class="summary">
      <div class="summary-card total">
        <h3>Presupuesto Total</h3>
        <div class="amount" id="totalBudget">€217,831</div>
      </div>
      <div class="summary-card used">
        <h3>Total Ejecutado</h3>
        <div class="amount" id="totalUsed">€0</div>
      </div>
      <div class="summary-card remaining">
        <h3>Saldo Disponible</h3>
        <div class="amount" id="totalRemaining">€217,831</div>
      </div>
    </div>

    <div class="table-container">
      <table id="budgetTable">
        <thead>
          <tr>
            <th>Código</th>
            <th>Partida / Descripción</th>
            <th>Categoría</th>
            <th>Presupuesto Original (€)</th>
            <th>Gastado (€)</th>
            <th>Saldo (€)</th>
            <th>% Ejecución</th>
            <th>Historial de Gastos</th>
          </tr>
        </thead>
        <tbody id="budgetTableBody"></tbody>
      </table>
    </div>
  </div>

  <script>
    const budgetData = [
      //... (tu arreglo original aquí, sin cambios)
      {
        code: "HR.SUP",
        description: "Supervisor Logístico/Administrativo",
        category: "Recursos Humanos",
        originalBudget: 20000,
        used: 0,
        expenses: []
      },
      {
        code: "HR.PM",
        description: "Coordinador del Proyecto (24 meses)",
        category: "Recursos Humanos",
        originalBudget: 24000,
        used: 0,
        expenses: []
      },
      //... el resto igual que tu código original
      {
        code: "IND",
        description: "Costos Indirectos (3%)",
        category: "Costos Indirectos",
        originalBudget: 6345,
        used: 0,
        expenses: []
      }
    ];

    const exchangeRate = 60; // 1 EUR = 60 DOP (tasa fija)
    let currentCurrency = 'EUR';

    function formatCurrency(amount) {
      if (currentCurrency === 'EUR') {
        return new Intl.NumberFormat('es-ES', {
          style: 'currency',
          currency: 'EUR',
          minimumFractionDigits: 2
        }).format(amount);
      } else {
        return new Intl.NumberFormat('es-DO', {
          style: 'currency',
          currency: 'DOP',
          minimumFractionDigits: 2
        }).format(amount);
      }
    }

    function convertAmount(amount, fromCurrency, toCurrency) {
      if (fromCurrency === toCurrency) return amount;
      if (fromCurrency === 'EUR' && toCurrency === 'DOP') return amount * exchangeRate;
      if (fromCurrency === 'DOP' && toCurrency === 'EUR') return amount / exchangeRate;
      return amount;
    }

    function renderTable() {
      const tbody = document.getElementById('budgetTableBody');
      tbody.innerHTML = '';

      budgetData.forEach(item => {
        const remaining = item.originalBudget - item.used;
        const percentage = item.originalBudget > 0 ? (item.used / item.originalBudget) * 100 : 0;

        const row = document.createElement('tr');
        row.innerHTML = `
          <td><span class="code">${item.code}</span></td>
          <td><strong>${item.description}</strong></td>
          <td><span class="category">${item.category}</span></td>
          <td class="amount">${formatCurrency(item.originalBudget)}</td>
          <td class="amount ${item.used > 0 ? 'negative' : ''}">${formatCurrency(item.used)}</td>
          <td class="amount ${remaining >= 0 ? 'positive' : 'negative'}">${formatCurrency(remaining)}</td>
          <td>
            <div>${percentage.toFixed(1)}%</div>
            <div class="progress-bar">
              <div class="progress-fill ${percentage > 100 ? 'over' : ''}" style="width: ${Math.min(percentage, 100)}%"></div>
            </div>
          </td>
          <td>
            <div class="expense-log">
              ${
                item.expenses.length > 0
                  ? item.expenses
                      .map(
                        expense => `
                <div class="expense-item">
                  <div>
                    <div>${expense.description}</div>
                    <div class="expense-date">${expense.date}</div>
                  </div>
                  <div class="expense-amount">${formatCurrency(expense.amount)}</div>
                </div>
              `
                      )
                      .join('')
                  : '<div style="color: #999; text-align: center; padding: 20px;">No hay gastos registrados</div>'
              }
            </div>
          </td>
        `;
        tbody.appendChild(row);
      });
    }

    function populateSelect() {
      const select = document.getElementById('expenseCategory');
      select.innerHTML = '<option value="">Seleccione una partida...</option>';

      budgetData.forEach(item => {
        const option = document.createElement('option');
        option.value = item.code;
        option.textContent = `${item.code} - ${item.description}`;
        select.appendChild(option);
      });
    }

    function updateSummary() {
      const totalBudget = budgetData.reduce((sum, item) => sum + item.originalBudget, 0);
      const totalUsed = budgetData.reduce((sum, item) => sum + item.used, 0);
      const totalRemaining = totalBudget - totalUsed;

      document.getElementById('totalBudget').textContent = formatCurrency(totalBudget);
      document.getElementById('totalUsed').textContent = formatCurrency(totalUsed);
      document.getElementById('totalRemaining').textContent = formatCurrency(totalRemaining);
    }

    function addExpense() {
      const categoryCode = document.getElementById('expenseCategory').value;
      const amount = parseFloat(document.getElementById('expenseAmount').value);
      const description = document.getElementById('expenseDescription').value.trim();

      if (!categoryCode || !amount || amount <= 0 || !description) {
        alert('Por favor complete todos los campos correctamente.');
        return;
      }

      const item = budgetData.find(item => item.code === categoryCode);
      if (!item) {
        alert('Partida no encontrada.');
        return;
      }

      const expense = {
        amount: amount,
        description: description,
        date: new Date().toLocaleDateString('es-ES')
      };

      item.used += amount;
      item.expenses.push(expense);

      // Limpiar formulario
      document.getElementById('expenseCategory').value = '';
      document.getElementById('expenseAmount').value = '';
      document.getElementById('expenseDescription').value = '';

      renderTable();
      updateSummary();
    }

    function toggleCurrency() {
      const select = document.getElementById('currencySwitch');
      const newCurrency = select.value;
      if (newCurrency === currentCurrency) return;

      // Convertir todos los valores a la nueva moneda
      budgetData.forEach(item => {
        item.originalBudget = convertAmount(item.originalBudget, currentCurrency, newCurrency);
        item.used = convertAmount(item.used, currentCurrency, newCurrency);
        item.expenses.forEach(expense => {
          expense.amount = convertAmount(expense.amount, currentCurrency, newCurrency);
        });
      });

      currentCurrency = newCurrency;

      // Actualizar etiquetas y placeholders
      const amountLabel = document.querySelector('label[for="expenseAmount"]');
      const amountInput = document.getElementById('expenseAmount');

      if (currentCurrency === 'EUR') {
        amountLabel.textContent = 'Monto (€)';
        amountInput.placeholder = '0.00';
      } else {
        amountLabel.textContent = 'Monto (RD$)';
        amountInput.placeholder = '0.00';
      }

      renderTable();
      updateSummary();
    }

    // Inicialización
    populateSelect();
    renderTable();
    updateSummary();
  </script>
</body>
</html>
